# 테스트케이스 작성과  Given-When-Then 패턴.md

출처: [스프링 입문 - 코드로 배우는 스프링 부트, 웹 MVC, DB 접근 기술](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%EC%9E%85%EB%AC%B8-%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8/dashboard)

## JUnit을 사용하는 이유?

 자바의 메인메서드 혹은 컨트롤러를 통해서 테스트를 실행할수도 있다.<br>
하지만 이와 같은 방법은 **한번에 여러 메서드를 테스트할 수 없고 println을 통해 직접 눈으로 확인을 해야하기 때문에 테스트해야 할 코드가 많아질수록 비효율적이고 부정확하다**

 JUnit이라는 프레임워크를 통해 위의 문제를 해결하고 JUnit의 Assertions내장함수를 통해 간단하게 내가 작성한 코드가 맞는지 확인할 수 있다. 

<br>

## 통합테스트 vs 단위테스트

#### 단위테스트

 * 장점
   * 클래스 혹은 메서드 단위로 테스트를 하기 때문에 테스트속도가 빠르다
   * 단위의 크기가 작아 복잡성이 낮고 디버깅이 쉽다

* 단점
  * 스프링 부트 컨테이너를 띄워 테스트하는 것이 아니기때문에 **실제 환경에서 잘 동작하는지 검증X**

#### 통합테스트

 여러 클래스를 통합하여 실제 운영 환경에서 제대로 동작하는지 테스트
 
 * 장점
   * 스프링부트 컨테이너를 띄워 테스트하기 때문에 실제 운영환경과 유사한 테스트 가능
   * 전체 플로우를 테스트하기 때문에 단위테스트에서 발견할수 없는 문제를 발견할 수 있다

 * 단점
   * 테스트시간이 오래걸림
   * 테스트 단위가 커서 디버깅이 어렵다

<br>

#### 단위테스트 작성 간단한 예시

![image](https://user-images.githubusercontent.com/83762364/182673437-ecbafca3-4853-449a-bc9c-dc6002a35dd8.png)

#### 통합테스트 작성 간단한 예시

![image](https://user-images.githubusercontent.com/83762364/183048858-edf6b213-5e4d-46b7-b4ab-ce76e9fee8a3.png)

#### 통합테스트의 @SpringBootTest, @Transactional

*  @SpringBootTest: 통합테스를 제공하는 기본적인 스프링부트 테스트 어노테이션
*  @Transactional: 통합테스트시 쿼리를 날리고 commit하지 않고 rollback 처리
<br>

## Given-When-Then 패턴

테스트 코드를 작성하는 표현 방식으로 **준비 - 실행 - 검증** 이다

위의 예시는 아주 간단한 회원가입을 하는 테스트코드 이다

* given: 테스트를 위해 준비하는 과정으로 테스트에 사용하는 변수, 입력 값 등을 정의한다
* when: 실제로 액션을 테스트하는 단계
* then: 내가 실행한 코드가 정상적으로 동작하는지 검증하는 단계, 위의 예시에서는 assertThat을 통해 회원가입시 입력한 네임과 가입해서 생긴 고유아이디를 통해 조회한 네임이 같은지를 검증



## 테스트코드 작성 시 고려해야 할 것

* 테스트를 위해 작성한 메서드가 순서대로 실행된다는 보장이 없어서 데이터 중복등의 문제가 발생
* 따라서 **테스트는 순서에 의존적이지 않아야 하고** 이를 위해 **테스트 하나가 끝날때마다 데이터나 공통의 저장소 등을 비워주는 과정이 필요**
  * **단위테스트**에서 @BeforeEach를 통해 테스트가 하나 실행될때마다 새로운 memberService를 주입받음
  * **단위테스트**에서 @AfterEach를 통해 테스트 하나가 끝나면 MemoryMemberRepository에 직접 정의한 clearStore()를 통해 공통저장소인 store를 초기화해줌
  * **통합테스트**에서 @Transactional을 통해 db의 데이터를 저장하지않고 rollback

결론적으로 **테스트간 연관관계를 낮추는게 핵심**

